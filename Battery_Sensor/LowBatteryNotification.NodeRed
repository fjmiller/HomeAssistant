[{"id":"6376aa21.653794","type":"function","z":"9182f0e7.6b642","name":"Set Entity Error Message","func":"//Build List of Entities\n//entityArray = JSON.parse(msg.data.new_state.attributes.entities);\nentityArray=msg.data.new_state.attributes.entities;\n\nmessage = \"\";\nfor (index = 0; index < entityArray.length; index++){\n    if (message !== \"\")\n    {\n        message = message + \",\";\n    }\n    message = message + entityArray[index][1].friendly_name\n}\n\nif (msg.payload === \"\" || msg.payload === null) { msg.payload = \"Nothing to Say about this\"; }\nmsg.payload = \n{\n  \"data\" : {\n      \"title\" : msg.payload + \" Entities with Battery Issues\",\n      \"message\" : message\n   }\n}    \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":450,"y":340,"wires":[["e8dfd232.be224"]]}]